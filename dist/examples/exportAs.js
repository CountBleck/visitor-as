import { LiteralKind, } from "assemblyscript/dist/assemblyscript.js";
import { Transform } from "assemblyscript/dist/transform.js";
import { getDecorator, hasDecorator, isLibrary, isUserEntry } from "../utils.js";
function getName(element) {
    let decorator = getDecorator(element.declaration, "exportAs");
    if (decorator.args == null) {
        throw Error("exportAs expects a string argument but got null.");
    }
    if (decorator.args.length != 1) {
        throw Error(`exportAs expects 1 argument but got ${decorator.args.length}`);
    }
    if (!decorator.args[0].isLiteralKind(LiteralKind.STRING)) {
        throw Error("exportAs expects a string argument");
    }
    return decorator.args[0].value;
}
class Transformer extends Transform {
    afterInitialize(program) {
        let files = Array.from(program.filesByName.values()).filter((file) => isUserEntry(file.source) && !isLibrary(file.source));
        for (let file of files) {
            for (let _export of file.exports?.values() || []) {
                if (_export != null && hasDecorator(_export, "exportAs")) {
                    let newName = getName(_export);
                    file.exports?.delete(_export.name);
                    file.exports?.set(newName, _export);
                }
            }
        }
    }
}
export default Transformer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0QXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXhhbXBsZXMvZXhwb3J0QXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFdBQVcsR0FJWixNQUFNLHVDQUF1QyxDQUFDO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUM3RCxPQUFPLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWpGLFNBQVMsT0FBTyxDQUFDLE9BQXdCO0lBQ3ZDLElBQUksU0FBUyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzlELElBQUksU0FBUyxDQUFDLElBQUksSUFBSSxJQUFJLEVBQUU7UUFDMUIsTUFBTSxLQUFLLENBQUMsa0RBQWtELENBQUMsQ0FBQztLQUNqRTtJQUNELElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1FBQzlCLE1BQU0sS0FBSyxDQUFDLHVDQUF1QyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7S0FDN0U7SUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ3hELE1BQU0sS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7S0FDbkQ7SUFDRCxPQUFpQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBRSxDQUFDLEtBQUssQ0FBQztBQUM1RCxDQUFDO0FBRUQsTUFBTSxXQUFZLFNBQVEsU0FBUztJQUNqQyxlQUFlLENBQUMsT0FBZ0I7UUFDOUIsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsTUFBTSxDQUN6RCxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQzlELENBQUM7UUFDRixLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssRUFBRTtZQUN0QixLQUFLLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFO2dCQUNoRCxJQUFJLE9BQU8sSUFBSSxJQUFJLElBQUksWUFBWSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsRUFBRTtvQkFDeEQsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUMvQixJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ25DLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztpQkFDckM7YUFDRjtTQUNGO0lBQ0gsQ0FBQztDQUNGO0FBRUQsZUFBZSxXQUFXLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBMaXRlcmFsS2luZCxcbiAgU3RyaW5nTGl0ZXJhbEV4cHJlc3Npb24sXG4gIFByb2dyYW0sXG4gIERlY2xhcmVkRWxlbWVudCxcbn0gZnJvbSBcImFzc2VtYmx5c2NyaXB0L2Rpc3QvYXNzZW1ibHlzY3JpcHQuanNcIjtcbmltcG9ydCB7IFRyYW5zZm9ybSB9IGZyb20gXCJhc3NlbWJseXNjcmlwdC9kaXN0L3RyYW5zZm9ybS5qc1wiO1xuaW1wb3J0IHsgZ2V0RGVjb3JhdG9yLCBoYXNEZWNvcmF0b3IsIGlzTGlicmFyeSwgaXNVc2VyRW50cnkgfSBmcm9tIFwiLi4vdXRpbHMuanNcIjtcblxuZnVuY3Rpb24gZ2V0TmFtZShlbGVtZW50OiBEZWNsYXJlZEVsZW1lbnQpOiBzdHJpbmcge1xuICBsZXQgZGVjb3JhdG9yID0gZ2V0RGVjb3JhdG9yKGVsZW1lbnQuZGVjbGFyYXRpb24sIFwiZXhwb3J0QXNcIik7XG4gIGlmIChkZWNvcmF0b3IuYXJncyA9PSBudWxsKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJleHBvcnRBcyBleHBlY3RzIGEgc3RyaW5nIGFyZ3VtZW50IGJ1dCBnb3QgbnVsbC5cIik7XG4gIH1cbiAgaWYgKGRlY29yYXRvci5hcmdzLmxlbmd0aCAhPSAxKSB7XG4gICAgdGhyb3cgRXJyb3IoYGV4cG9ydEFzIGV4cGVjdHMgMSBhcmd1bWVudCBidXQgZ290ICR7ZGVjb3JhdG9yLmFyZ3MubGVuZ3RofWApO1xuICB9XG4gIGlmICghZGVjb3JhdG9yLmFyZ3NbMF0uaXNMaXRlcmFsS2luZChMaXRlcmFsS2luZC5TVFJJTkcpKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJleHBvcnRBcyBleHBlY3RzIGEgc3RyaW5nIGFyZ3VtZW50XCIpO1xuICB9XG4gIHJldHVybiAoPFN0cmluZ0xpdGVyYWxFeHByZXNzaW9uPmRlY29yYXRvci5hcmdzWzBdKS52YWx1ZTtcbn1cblxuY2xhc3MgVHJhbnNmb3JtZXIgZXh0ZW5kcyBUcmFuc2Zvcm0ge1xuICBhZnRlckluaXRpYWxpemUocHJvZ3JhbTogUHJvZ3JhbSk6IHZvaWQge1xuICAgIGxldCBmaWxlcyA9IEFycmF5LmZyb20ocHJvZ3JhbS5maWxlc0J5TmFtZS52YWx1ZXMoKSkuZmlsdGVyKFxuICAgICAgKGZpbGUpID0+IGlzVXNlckVudHJ5KGZpbGUuc291cmNlKSAmJiAhaXNMaWJyYXJ5KGZpbGUuc291cmNlKVxuICAgICk7XG4gICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykge1xuICAgICAgZm9yIChsZXQgX2V4cG9ydCBvZiBmaWxlLmV4cG9ydHM/LnZhbHVlcygpIHx8IFtdKSB7XG4gICAgICAgIGlmIChfZXhwb3J0ICE9IG51bGwgJiYgaGFzRGVjb3JhdG9yKF9leHBvcnQsIFwiZXhwb3J0QXNcIikpIHtcbiAgICAgICAgICBsZXQgbmV3TmFtZSA9IGdldE5hbWUoX2V4cG9ydCk7XG4gICAgICAgICAgZmlsZS5leHBvcnRzPy5kZWxldGUoX2V4cG9ydC5uYW1lKTtcbiAgICAgICAgICBmaWxlLmV4cG9ydHM/LnNldChuZXdOYW1lLCBfZXhwb3J0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUcmFuc2Zvcm1lcjtcbiJdfQ==